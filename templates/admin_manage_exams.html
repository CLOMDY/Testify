<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Manage Exams | Online Exam Portal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <style>
    .modal-body {
      max-height: 70vh;
      /* adjust as needed */
      overflow-y: auto;
    }
  </style>

</head>

<body class="bg-light">

  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="{{ url_for('admin.dashboard') }}">Teacher Dashboard</a>
      <a href="{{ url_for('auth.logout') }}" class="btn btn-danger">Logout</a>
    </div>
  </nav>
  <div class="container mt-4">
    <div class="row">
      <h3>Available Exam</h3>

      {% if exams %}
      {% for exam in exams %}
      <div class="col-md-4 mb-3">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title">{{ exam.title }}</h5>

            <!-- Edit Button -->
            <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#editExamModal{{ exam.id }}">
              Edit Exam
            </button>

            <!-- Delete Button triggers confirmation modal -->
            <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteExamModal{{ exam.id }}">
              Delete
            </button>
          </div>
        </div>
      </div>

      <!-- Delete Confirmation Modal -->
      <div class="modal fade" id="deleteExamModal{{ exam.id }}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Confirm Delete</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              Are you sure you want to delete the exam "<strong>{{ exam.title }}</strong>"?
              This action cannot be undone.
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <form method="POST" action="{{ url_for('admin.delete_exam', exam_id=exam.id) }}" style="display:inline;">
                <button type="submit" class="btn btn-danger">Yes, Delete</button>
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- Edit Exam Modal -->
      <div class="modal fade" id="editExamModal{{ exam.id }}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
          <div class="modal-content">
            <form method="POST" action="{{ url_for('admin.edit_exam', exam_id=exam.id) }}">
              <div class="modal-header">
                <h5 class="modal-title">Edit Exam: {{ exam.title }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>

              <div class="modal-body">
                <!-- Exam Info -->
                <div class="row mb-3">
                  <div class="col-md-8">
                    <label class="form-label">Exam Title</label>
                    <input type="text" name="exam_title" class="form-control" value="{{ exam.title }}" required>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">Exam Duration (minutes)</label>
                    <input type="number" name="exam_duration" class="form-control" value="{{ exam.duration }}" required>
                  </div>
                </div>

                <!-- Loop through questions -->
                {% for q in exam.questions %}
                <div class="card mb-3 shadow-sm">
                  <div class="card-body">
                    <h6 class="mb-3">Question {{ loop.index }}</h6>

                    <div class="row g-3">
                      <div class="col-12">
                        <textarea name="question_{{ q.id }}" class="form-control" rows="2"
                          required>{{ q.question_text }}</textarea>
                      </div>

                      <div class="col-md-6">
                        <input type="text" name="option_a_{{ q.id }}" class="form-control" value="{{ q.option_a }}"
                          placeholder="Option A" required>
                      </div>
                      <div class="col-md-6">
                        <input type="text" name="option_b_{{ q.id }}" class="form-control" value="{{ q.option_b }}"
                          placeholder="Option B" required>
                      </div>
                      <div class="col-md-6">
                        <input type="text" name="option_c_{{ q.id }}" class="form-control" value="{{ q.option_c }}"
                          placeholder="Option C" required>
                      </div>
                      <div class="col-md-6">
                        <input type="text" name="option_d_{{ q.id }}" class="form-control" value="{{ q.option_d }}"
                          placeholder="Option D" required>
                      </div>

                      <div class="col-md-4">
                        <label class="form-label">Correct Answer</label>
                        <select name="correct_{{ q.id }}" class="form-select" required>
                          <option value="A" {% if q.correct_option=='A' %}selected{% endif %}>A</option>
                          <option value="B" {% if q.correct_option=='B' %}selected{% endif %}>B</option>
                          <option value="C" {% if q.correct_option=='C' %}selected{% endif %}>C</option>
                          <option value="D" {% if q.correct_option=='D' %}selected{% endif %}>D</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                {% endfor %}
              </div>

              <div class="modal-footer">
                <button type="submit" class="btn btn-success">Save Changes</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Edit Modal code remains unchanged -->
      {% endfor %}
      {% else %}
      <div class="col-12">
        <button class="btn btn-secondary" disabled>No exam found</button>
      </div>
      {% endif %}
    </div>
  </div>

  <div class="container mt-4">
    <!-- Questions -->
    <div class="container mt-4">
      <h3>Create New Exam</h3>
      <form method="POST" action="{{ url_for('admin.manage_exams') }}">
        <!-- Exam Title -->
        <div class="mb-4">
          <label class="form-label"><strong>Exam Title</strong></label>
          <input type="text" name="exam_title" class="form-control" placeholder="Enter exam title" required>
        </div>

        <!-- Exam Duration -->
        <div class="mb-4">
          <label class="form-label"><strong>Exam Duration (minutes)</strong></label>
          <input type="number" name="exam_duration" class="form-control" placeholder="Enter duration in minutes"
            required min="1">
        </div>

        <!-- Number of Questions -->
        <div class="mb-4">
          <label for="num_questions" class="form-label"><strong>Number of Questions</strong></label>
          <div class="input-group">
            <input type="number" id="num_questions" name="num_questions" class="form-control"
              placeholder="Enter number of questions" min="1" required>
            <button type="button" id="showFormBtn" class="btn btn-success">Show</button>
          </div>
        </div>



        <!-- Where questions will be inserted -->
        <div id="questions-container"></div>

    </div>
    <script>
      document.getElementById("num_questions").addEventListener("change", function () {
        let container = document.getElementById("questions-container");
        container.innerHTML = ""; // clear old questions
        let count = parseInt(this.value);

        for (let i = 1; i <= count; i++) {
          container.innerHTML += `
              <div class="card mb-4 shadow-sm">
                <div class="card-body">
                  <h5 class="card-title">Question ${i}</h5>
        
                  <!-- Question Text -->
                  <div class="mb-3">
                    <textarea name="question_${i}" class="form-control" placeholder="Enter question text" rows="2" required></textarea>
                  </div>
        
                  <!-- Options -->
                  <div class="row g-2">
                    <div class="col-md-6">
                      <input type="text" name="optionA_${i}" class="form-control" placeholder="Option A" required>
                    </div>
                    <div class="col-md-6">
                      <input type="text" name="optionB_${i}" class="form-control" placeholder="Option B" required>
                    </div>
                    <div class="col-md-6">
                      <input type="text" name="optionC_${i}" class="form-control" placeholder="Option C" required>
                    </div>
                    <div class="col-md-6">
                      <input type="text" name="optionD_${i}" class="form-control" placeholder="Option D" required>
                    </div>
                  </div>
        
                  <!-- Correct Answer -->
                  <div class="mt-3">
                    <label class="form-label">Correct Answer</label>
                    <select name="correct_${i}" class="form-select" required>
                      <option value="">-- Select Correct Option --</option>
                      <option value="A">A</option>
                      <option value="B">B</option>
                      <option value="C">C</option>
                      <option value="D">D</option>
                    </select>
                  </div>
                </div>
              </div>
            `;
        }
      });
    </script>
    <!-- Submit -->
    <div class="text-center mb-5">
      <button type="submit" class="btn btn-success btn-lg">Save Exam</button>
    </div>
    </form>
  </div>

</body>

</html>